using System;
using System.Collections.Generic;
using System.ComponentModel;
using System.Data;
using System.Drawing;
using System.Linq;
using System.Text;
using System.Threading.Tasks;
using System.Windows.Forms;

namespace DexComanda.Relatorios.Fechamentos
{
    public partial class frmReportPedidosPorMotoboy : Form
    {
        private Conexao con;
        private DataSet dsPedidos;
        private DataView dvPedidos;
        public frmReportPedidosPorMotoboy()
        {
            con = new Conexao();
            InitializeComponent();
            dataInicio.Value = DateTime.Now;
            dataFim.Value = DateTime.Now.AddDays(1);
            InitializeComponent();
        }

        private void frmReportPedidosPorMotoboy_Load(object sender, EventArgs e)
        {
            // TODO: This line of code loads data into the 'dsRelatorio.vwObterPedidosPorBoy' table. You can move, or remove it, as needed.
            this.vwObterPedidosPorBoyTableAdapter.Fill(this.dsRelatorio.vwObterPedidosPorBoy);
            try
            {
                // this.pedidoTableAdapter.Fill(this.dBExpertDataSet.Pedido);
                this.cbxListaMotoboy.DataSource = con.SelectAll("Entregador", "spObterEntregadores").Tables["Entregador"];
                this.cbxListaMotoboy.DisplayMember = "Nome";
                this.cbxListaMotoboy.ValueMember = "Codigo";

            }
            catch (Exception err)
            {

                MessageBox.Show(err.Message);
            }
           
           
        }

        private void ConsultaPedidos(object sender, EventArgs e)
        {
            string strQuery;
            string iCodMotoboy;
            

            try
            {
                //Faz a consulta dos Pedidos
                dsPedidos = con.SelectView("vwObterPedidosPorBoy", "Pedido");

                //Pega a view padrão da tabela
                dvPedidos = dsPedidos.Tables[0].DefaultView;

               // Passa as Datas para o Filtro da Query
                var dtInicio = Convert.ToDateTime(dataInicio.Value.ToShortDateString() + " 00:00:00");
                var dtFim = Convert.ToDateTime(dataFim.Value.ToShortDateString() + " 23:59:59");
                strQuery = "RealizadoEM >= '" + dtInicio + "' AND RealizadoEM <='" + dtFim + "' ";

                if (cbxListaMotoboy.Text != "")
                {
                    strQuery = strQuery + " and CodMotoboy='" + cbxListaMotoboy.SelectedValue.ToString() + "'";
                }

                dvPedidos.RowFilter = strQuery;

                if (dvPedidos.Count>0)
                {
                  //Override do datasource setado por padrão no frmSelecionarCliente.Designer.cs
                    this.vwObterPedidosPorBoyBindingSource.DataSource = dvPedidos;

                    //Preenche o adapter e atualiza o reportview
                    //this.pedidoTableAdapter.Fill(this.dBExpertDataSet.Pedido);
                    this.reportPedidos.RefreshReport();

                    dsPedidos = null;
                    dvPedidos = null;
                    
                }
                else
                {
                    MessageBox.Show("Nenhum pedido encontrado no filtro preenchido","Dex Aviso");
                    //clientesGridView.DataSource = null;
                    this.reportPedidos.Clear();
                }

            }
            catch (Exception)
            {
                
                throw;
            }
           
        }
    }
}
